# This dockerfile performs a (nearly) minimal O2scl installation of
# the development version directly from main branch in the current
# repository. It includes readline, OpenMP and HDF5 compression
# support. It runs all of the O2scl tests and examples.

FROM ubuntu:latest 
MAINTAINER Andrew W. Steiner (awsteiner0@protonmail.com)

# -----------------------------------------------------------------
# To fix tzdata asking for a timezone during installation
# can set up later using sudo dpkg-reconfigure tzdata I think.

ARG DEBIAN_FRONTEND=noninteractive

# -----------------------------------------------------------------
# apt packages

RUN apt-get -y update
# compiler, make and gsl
RUN apt-get -y install g++ make libgsl-dev autoconf automake libtool git
# HDF5, ncurses, and readline
RUN apt-get -y install libhdf5-dev libreadline-dev
# Boost
RUN apt-get -y install libboost-all-dev

# -----------------------------------------------------------------
# Now install o2scl

WORKDIR /opt
RUN git clone https://github.com/awsteiner/o2scl
WORKDIR /opt/o2scl
RUN autoreconf -i
RUN CXXFLAGS="-O3 -DO2SCL_UBUNTU_HDF5 -DO2SCL_HDF5_PRE_1_12 -DO2SCL_HDF5_COMP -I/usr/include" ./configure --enable-openmp
RUN make blank-doc
RUN make
RUN make install
WORKDIR /
ENV LD_LIBRARY_PATH /usr/local/lib
RUN acol -v
RUN acol -h
WORKDIR /opt/o2scl
RUN make o2scl-test
RUN make o2scl-examples




